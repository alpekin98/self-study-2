# Get Jenkins image
FROM jenkins/jenkins:lts
USER root

LABEL Name="jenkins-dockerfile"
LABEL version="1.0"

# RUN apt-get update -y
# RUN apt-get install make
# RUN apt-get install g++ -y
RUN apt-get update -y
RUN apt-get install apt-transport-https ca-certificates curl gnupg lsb-release -y
# RUN apt-get update
# RUN curl -fsSL https://download.docker.com/linux/debian/gpg | gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
# RUN echo "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/debian $(lsb_release -cs) stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null
# RUN apt-get install docker-ce docker-ce-cli containerd.io -y
# RUN service docker start
ENV JAVA_OPTS -Djenkins.install.runSetupWizard=false
ENV CASC_JENKINS_CONFIG /var/jenkins_home/casc.yaml

RUN touch /usr/share/jenkins/ref/plugins.txt
RUN echo "
ant:latest
antisamy-markup-formatter:latest
build-timeout:latest
cloudbees-folder:latest
configuration-as-code:latest
credentials-binding:latest
email-ext:latest
git:latest
github-branch-source:latest
gradle:latest
ldap:latest
mailer:latest
matrix-auth:latest
pam-auth:latest
pipeline-github-lib:latest
pipeline-stage-view:latest
ssh-slaves:latest
timestamper:latest
workflow-aggregator:latest
ws-cleanup:latest
job-dsl:latest
docker-plugin:latest
docker-workflow:latest
" >> /usr/share/jenkins/ref/plugins.txt

# # casc.yaml DosyasÄ± ....
# RUN echo -e '
# jenkins:
#   securityRealm:
#     local:
#       allowsSignup: false
#       users:
#         - id: admin
#           password: admin
# unclassified:
#   location:
#     url: http://192.168.55.10:8080/
#   globalLibraries:
#     libraries:
#       - name: "stage-hooks"
#         retriever:
#           modernSCM:
#             scm:
#               git:
#                 remote: "https://github.com/alpekin98/jenkins-shared-library-sample"
# jobs:
#   - script: >
#       pipelineJob("self-study-cpp") {
#         definition {
#           cpsScm {
#             scm {
#               git {
#                 remote {
#                   url("https://github.com/alpekin98/self-study-2.git")
#                 }
#                 branch("*/main")
#               }
#             }
#             lightweight()
#           }
#         }
#       }

# ' > /var/jenkins_home/casc.yaml

RUN /usr/local/bin/install-plugins.sh < /usr/share/jenkins/ref/plugins.txt
COPY casc.yaml /var/jenkins_home/casc.yaml